@page "/partinformation"
@using MES.Common
@inject HttpClient Http

<PageTitle>Part Details</PageTitle>

<div class="container mt-4">
    <h1>Part Details</h1>
    <div class="mb-3">
        <label for="serialInput" class="form-label">Serial Number</label>
        <input id="serialInput" class="form-control" @bind="serialNumber" />
    </div>
    <button class="btn btn-primary mb-3 top-row-color" @onclick="SearchPart">Search</button>
</div>
@if (isSearching)
{
    <div class="d-flex justify-content-center">
        <ProgressIndicator IsVisible="@isSearching" />
    </div>
}
else if (searchError != null)
{
    <div class="alert alert-danger">@searchError</div>
}
else if (foundPart != null)
{
    <div class="d-flex justify-content-center">
        <PartDetails Part="foundPart" />
    </div>
}

@code {
    private string serialNumber = string.Empty;
    private PartDataDto? foundPart;
    private bool isSearching = false;
    private string? searchError;

    private async Task SearchPart()
    {
        isSearching = true;
        searchError = null;
        foundPart = null;

        try
        {
            foundPart = await Http.GetFromJsonAsync<PartDataDto>($"https://localhost:7195/api/PartData/GetBySerial/{serialNumber}");
            await Task.Delay(1000);
            if (foundPart == null)
            {
                searchError = "Part not found.";
            }
        }
        catch (Exception ex)
        {
            searchError = $"Error: {ex.Message}";
        }
        finally
        {
            isSearching = false;
        }
    }
}


